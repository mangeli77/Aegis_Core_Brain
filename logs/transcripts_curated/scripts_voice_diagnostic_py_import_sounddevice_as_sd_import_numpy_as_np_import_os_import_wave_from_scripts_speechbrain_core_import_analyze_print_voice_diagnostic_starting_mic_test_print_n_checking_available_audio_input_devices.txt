[2025-07-06T00:00:2043Z] (neutral) ") devices = sd.query_devices() input_devices = [d for d in devices if d['max_input_channels'] > 0] for idx, dev in enumerate(input_devices): print(f" [{idx}] {dev['name']}") if not input_devices: print("? No input devices found.") exit(1) print("\n? Mic device(s) found.") duration = 3 # seconds fs = 16000 print(f"\n?? Recording {duration} seconds from default mic...") recording = sd.rec(int(duration * fs), samplerate=fs, channels=1, dtype='int16') sd.wait() print("? Recording complete.") # Save to temp WAV file temp_dir = "samples" os.makedirs(temp_dir, exist_ok=True) test_path = os.path.join(temp_dir, "test_input.wav") ref_path = os.path.join(temp_dir, "speaker_reference.wav") with wave.open(test_path, 'w') as wf: wf.setnchannels(1) wf.setsampwidth(2) wf.setframerate(fs) wf.writeframes(recording.tobytes()) # === ANALYZE === if not os.path.exists(ref_path): # Save the first test as the reference if it doesn't exist print("?? No reference found. Saving current recording as speaker_reference.wav") os.rename(test_path, ref_path) exit(0) print("\n?? Running SpeechBrain analysis...") result = analyze(test_path, ref_path) print(f"? Match Score: {result['match_score']}") print(f"?? Verified Match: {result['verified']}") print(f"?? Emotion Detected: {result['emotion']}") [## scripts/voice_diagnostic.py import sounddevice as sd import numpy as np import os import wave from scripts.speechbrain_core import analyze print("??? voice diagnostic starting...") # === mic test === print("\n?? checking available audio input devices #seg-2044]
